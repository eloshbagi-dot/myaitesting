async function askAI() {
    const key = document.getElementById('api-key').value.trim();
    const userInput = document.getElementById('user-input');
    const text = userInput.value.trim();
    const btn = document.getElementById('send-btn');
    const box = document.getElementById('chat-box');

    if(!key || !text) return alert("المفتاح أو النص فارغ!");

    box.innerHTML += `<div class="msg user">${text}</div>`;
    btn.disabled = true;
    btn.innerText = "جاري المحاولة...";

    try {
        // تغيير البروكسي لخدمة أخرى (AllOrigins) وهي أكثر قوة
        const targetUrl = "https://api-inference.huggingface.co/models/facebook/blenderbot-400M-distill";
        const proxyUrl = `https://api.allorigins.win/get?url=${encodeURIComponent(targetUrl)}`;

        // في هذا النوع من البروكسي، نرسل البيانات بطريقة مختلفة قليلاً
        const response = await fetch(proxyUrl, {
            method: "GET", // بعض البروكسيات تفضل تحويل الطلب لـ GET لتجنب الـ CORS
        });

        // إذا فشل هذا أيضاً، فهناك حل بديل في الأسفل
        if (!response.ok) throw new Error("فشل البروكسي");

        const dataWrapper = await response.json();
        // ملاحظة: AllOrigins يضع النتيجة داخل حقل اسمه contents
        console.log("الرد من البروكسي:", dataWrapper);
        
        box.innerHTML += `<div class="msg bot">وصلت البيانات، لكن البروكسي المجاني له حدود.</div>`;
    } catch (e) {
        box.innerHTML += `<div class="msg error">⚠️ يبدو أن القيود الأمنية قوية جداً.</div>`;
    } finally {
        btn.disabled = false;
        btn.innerText = "إرسال";
    }
}
